<p-card class="card">
  <ng-template #header>
    <p class="text-3xl font-bold px-4 pt-2">Savatlar to'plami</p>
  </ng-template>

  <!-- â— Bo'sh holat -->
  @if (cartSessionModel.length === 0 && !searchValue) {
    <div
      class="relative flex flex-col items-center justify-center border rounded px-20 py-24 text-center transition-all duration-200 mt-0"
    >
      <img ngSrc="assets/images/icons/cart.gif" width="200" height="200" alt="icon" />

      <p class="text-2xl font-bold">
        Savatlar to'plami
      </p>

      <span class="text-sm max-w-3xl">
        Xaridorlar uchun yaratilgan savatlar ro'yxati. To'lov jarayonini tezlashtirish,
        savdo holatini kuzatish va nazoratni soddalashtirish uchun savat yarating.
      </span>

      <div class="flex justify-between mt-4">
        <p-button
          *kaHasRoles="['ROLE_CART_CREATE']"
          class="p-2"
          styleClass="shadow shadow-blue-500/50"
          icon="pi pi-plus"
          label="Yangi savat yaratish"
          (click)="showCreateCartModal = true"
        />
      </div>
    </div>

    <p class="text-md font-bold p-4">Tezkor savat yaratish</p>

    <div class="flex items-center justify-between gap-2">
      <input
        pInputText
        placeholder="Savat raqami"
        [(ngModel)]="newCart.cartNumber"
      />

      <p-button
        icon="pi pi-save"
        label="Saqlash"
      ></p-button>
    </div>

    <p-divider></p-divider>

  } @else {

    <!-- ðŸ”Ž Qidiruv + Amallar -->
    <div class="flex w-full justify-between gap-2 p-4 pb-0">
      <p-icon-field iconPosition="right" class="pr-2">
        <p-inputicon class="pi pi-search"></p-inputicon>
        <input
          type="text"
          pInputText
          placeholder="Qidiruv"
          [(ngModel)]="searchValue"
        />
      </p-icon-field>

      <p-button
        *kaHasRoles="['ROLE_CART_CREATE']"
        class="pr-2"
        styleClass="shadow shadow-blue-500/50"
        icon="pi pi-plus"
        label="Yangi savat yaratish"
        (click)="showCreateCartModal = true"
      />
    </div>

    <!-- ðŸ§¾ TABLE -->
    <p-table
      size="small"
      #dataTableCart
      [value]="cartSessionModel"
      [rows]="10"
      [rowHover]="true"
      [paginator]="true"
      [rowsPerPageOptions]="[10,25,50]"
      [lazy]="true"
      [totalRecords]="totalRecords"
      (onLazyLoad)="pageChange($event)"
      dataKey="id"
      scrollHeight="80vh"
      [scrollable]="true"
    >
      <ng-template pTemplate="header">
        <tr class="border shadow h-[60px]">

          <th class="text-nowrap sort-header">â„–</th>

          <th class="text-center text-nowrap sort-header">Savat raqami</th>

          <th class="text-center text-nowrap sort-header">Holati</th>

          <th class="text-center text-nowrap sort-header">To'lov turi</th>

          <th class="text-center text-nowrap sort-header">To'lov holati</th>

          <th class="text-center text-nowrap sort-header">Jami summa</th>

          <th class="text-center text-nowrap sort-header">To'langan</th>

          <th class="text-center text-nowrap sort-header">Qarz</th>

          <th class="text-center text-nowrap sort-header">Yaratilgan vaqt</th>

          <th class="text-center text-nowrap sort-header">Yopilgan vaqt</th>

          <th class="text-center text-nowrap sort-header"></th>

        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-row let-i="rowIndex">
        <tr>

          <td class="text-center">{{ i + 1 }}</td>

          <td class="text-center">{{ row.cartNumber }}</td>

          <td class="text-center">
            <p-tag
              [value]="row.status"
              [severity]="row.status === 'OPEN' ? 'info' : row.status === 'CLOSED' ? 'success' : 'danger'"
            ></p-tag>
          </td>

          <td class="text-center">
            <p-tag [value]="row.paymentType"></p-tag>
          </td>

          <td class="text-center">
            <p-tag
              [value]="row.paymentStatus"></p-tag>
          </td>

          <td class="text-center">{{ row.totalAmount | number:'1.2-2' }}</td>
          <td class="text-center">{{ row.paidAmount | number:'1.2-2' }}</td>
          <td class="text-center text-red-500 font-bold">{{ row.debtAmount | number:'1.2-2' }}</td>

          <td class="text-center">{{ row.createdAt | date:'dd.MM.yyyy HH:mm' }}</td>
          <td class="text-center">{{ row.closedAt ? (row.closedAt | date:'dd.MM.yyyy HH:mm') : '-' }}</td>

          <td class="text-center">
<!--            [model]="getRowActions(row)"-->
            <p-menu #actionTable [popup]="true"></p-menu>
            <p-button [text]="true" (click)="actionTable.toggle($event)" icon="pi pi-ellipsis-h" />
          </td>

        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="10">
            <div class="flex flex-col items-center justify-center p-6 text-gray-500">
              <i class="pi pi-info-circle text-3xl mb-2"></i>
              <span>Savatlar topilmadi</span>
            </div>
          </td>
        </tr>
      </ng-template>

    </p-table>
  }
</p-card>
