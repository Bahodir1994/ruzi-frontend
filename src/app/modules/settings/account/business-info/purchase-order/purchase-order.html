<div class="w-full flex justify-start py-2">
  <div class="flex">
    <p-icon-field iconPosition="right" class="pr-2">
      <p-inputicon class="pi pi-search"></p-inputicon>
      <input
        type="search"
        pInputText
        pSize="small"
        placeholder="Qidiruv"
        [(ngModel)]="searchValue"
        (input)="loadData()"
      />
    </p-icon-field>
    @if (permissions['add_new_product']) {
      <p-button
        (click)="openDialog()"
        size="small"
        class="pr-2"
        styleClass="shadow shadow-blue-500/50"
        icon="pi pi-file-plus"
        label="Yangi tovar qo'shish"
        [outlined]="true"
      />
    }
  </div>
</div>
<p-table
  size="small"
  #dataTableUnit
  [value]="purchaseOrderModel"
  dataKey="id"
  [rowHover]="true"
  [rows]="10"
  [showCurrentPageReport]="true"
  [rowsPerPageOptions]="[10, 25, 50]"
  loadingIcon="pi pi-spinner"
  [paginator]="true"
  currentPageReportTemplate="{totalPages} ta dan {currentPage}-saxifa, jami {totalRecords} ta dan {first}-{last} gacha"
  [filterDelay]="0"
  [scrollable]="true"
  [totalRecords]="totalRecords"
  [lazy]="true"
  (onLazyLoad)="pageChange($event)"
  [first]="0"
  [pageLinks]="5"
  [showJumpToPageInput]="true"
  scrollHeight="80vh"
>
  <ng-template pTemplate="header">
    <tr class="border shadow h-[60px]">
      <th pSortableColumn="orderNumber" class="text-center text-nowrap sort-header">
        Buyurtma №
        <p-sortIcon field="orderNumber" />
      </th>
      <th pSortableColumn="supplier.name" class="text-center text-nowrap sort-header">
        Ta’minotchi
        <p-sortIcon field="supplier.name" />
      </th>
      <th pSortableColumn="warehouse.name" class="text-center text-nowrap sort-header">
        Ombor
        <p-sortIcon field="warehouse.name" />
      </th>
      <th pSortableColumn="createdAt" class="text-center text-nowrap sort-header">
        Sana
        <p-sortIcon field="createdAt" />
      </th>
      <th pSortableColumn="status" class="text-center text-nowrap sort-header">
        Holat
        <p-sortIcon field="status" />
      </th>
      <th pSortableColumn="paymentStatus" class="text-center text-nowrap sort-header">
        To‘lov
        <p-sortIcon field="paymentStatus" />
      </th>
      <th pSortableColumn="totalAmount" class="text-center text-nowrap sort-header">
        Summasi
        <p-sortIcon field="totalAmount" />
      </th>
    </tr>
  </ng-template>

  <ng-template pTemplate="body" let-row let-i="rowIndex">
    <tr style="height:49px">
      <td class="text-nowrap text-center">{{ row.orderNumber }}</td>
      <td class="text-nowrap text-center">{{ row.supplier?.name }}</td>
      <td class="text-nowrap text-center">{{ row.warehouse?.name }}</td>
      <td class="text-nowrap text-center">{{ row.createdAt | date:'dd.MM.yyyy' }}</td>
      <td class="text-nowrap text-center">
      <span [ngClass]="{
        'text-gray-500': row.status === 'DRAFT',
        'text-green-600': row.status === 'APPROVED',
        'text-red-600': row.status === 'CANCELLED'
      }">
        {{ row.status }}
      </span>
      </td>
      <td class="text-nowrap text-center">
      <span [ngClass]="{
        'text-red-500': row.paymentStatus === 'UNPAID',
        'text-orange-500': row.paymentStatus === 'PARTIAL',
        'text-green-600': row.paymentStatus === 'PAID'
      }">
        {{ row.paymentStatus }}
      </span>
      </td>
      <td class="text-nowrap text-center">{{ row.totalAmount | number:'1.2-2' }}</td>
    </tr>
  </ng-template>

  <ng-template pTemplate="emptymessage">
    <tr>
      <td [attr.colspan]="7" class="mx-auto">
        <div class="flex flex-col items-center justify-center p-6 text-gray-500">
          <i class="pi pi-info-circle text-3xl mb-2"></i>
          <span>Buyurtmalar topilmadi</span>
        </div>
      </td>
    </tr>
  </ng-template>


</p-table>

<p-dialog
  [(visible)]="visiblePurchaseOrderModal"
  [modal]="true"
  [draggable]="false"
  [resizable]="true"
  [closable]="true"
  [maximizable]="false"
  [dismissableMask]="true"
  [style]="{ width: '100vw', height: '100vh', margin: 0, padding: 0 }"
  [baseZIndex]="10000">
</p-dialog>
