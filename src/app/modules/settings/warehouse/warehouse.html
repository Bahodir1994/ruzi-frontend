<div class="w-full flex justify-start py-2">
  <div class="flex w-full justify-between items-center">
    <div class="flex">
      <p-icon-field iconPosition="right" class="pr-2">
        <p-inputicon class="pi pi-search"></p-inputicon>
        <input
          type="search"
          pInputText
          pSize="small"
          placeholder="Qidiruv"
          [(ngModel)]="searchValue"
          (input)="loadData()"
        />
      </p-icon-field>
    </div>

    @if (permissions['add_new_warehouse']) {
      <p-button
        (click)="openDialog()"
        size="small"
        icon="pi pi-plus"
        label="Yangi ombor qo‘shish"
        styleClass="shadow shadow-blue-500/50"
        [outlined]="true"
      />
    }
  </div>
</div>

<p-table
  size="small"
  #dataTableWarehouse
  [value]="warehouseModel"
  dataKey="id"
  [rowHover]="true"
  [rows]="10"
  [showCurrentPageReport]="true"
  [rowsPerPageOptions]="[10, 25, 50]"
  [paginator]="true"
  [totalRecords]="totalRecords"
  [lazy]="true"
  (onLazyLoad)="pageChange($event)"
  scrollHeight="75vh"
  [filterDelay]="0"
>
  <ng-template pTemplate="header">
    <tr class="border shadow h-[60px]">
      <th pSortableColumn="name" class="text-center text-nowrap sort-header">
        Ombor nomi
        <p-sortIcon field="name"/>
      </th>
      <th pSortableColumn="address" class="text-center text-nowrap sort-header">
        Manzili
        <p-sortIcon field="address"/>
      </th>
      <th pSortableColumn="type" class="text-center text-nowrap sort-header">
        Turi
        <p-sortIcon field="type"/>
      </th>
      <th pSortableColumn="status" class="text-center text-nowrap sort-header">
        Holati
        <p-sortIcon field="status"/>
      </th>
    </tr>
  </ng-template>

  <ng-template pTemplate="body" let-row let-i="rowIndex">
    <tr style="height:49px">
      <td class="text-nowrap text-center font-medium">{{ row.name }}</td>
      <td class="text-nowrap text-center">{{ row.address || '-' }}</td>
      <td class="text-nowrap text-center">
        @switch (row.type) {
          @case ('MAIN') {
            <span class="text-blue-600 font-medium">Markaziy</span>
          }
          @case ('BRANCH') {
            <span class="text-green-600 font-medium">Filial</span>
          }
          @case ('MOBILE') {
            <span class="text-orange-500 font-medium">Mobil</span>
          }
          @default {
            <span class="text-gray-400">-</span>
          }
        }
      </td>
      <td class="text-nowrap text-center">
        <span [ngClass]="{
          'text-green-600 font-semibold': row.status === 'ACTIVE',
          'text-red-500 font-semibold': row.status === 'INACTIVE'
        }">
          {{ row.status }}
        </span>
      </td>
    </tr>
  </ng-template>

  <ng-template pTemplate="emptymessage">
    <tr>
      <td [attr.colspan]="4" class="mx-auto">
        <div class="flex flex-col items-center justify-center p-6 text-gray-500">
          <i class="pi pi-info-circle text-3xl mb-2"></i>
          <span>Omborlar topilmadi</span>
        </div>
      </td>
    </tr>
  </ng-template>
</p-table>

<p-dialog
  [(visible)]="visibleWarehouseOrderModal"
  [modal]="true"
  [draggable]="false"
  [resizable]="true"
  [closable]="true"
  [maximizable]="false"
  [dismissableMask]="true"
  [style]="{ width: '60vw', height: '80vh' }"
  [baseZIndex]="10000"
>
  <ng-template pTemplate="header">Yangi ombor</ng-template>
  <ng-template pTemplate="content">
    <!-- bu yerda ombor qo‘shish yoki tahrirlash form bo‘ladi -->
  </ng-template>
</p-dialog>
